#!/bin/bash

source ~/.klik/venv-metal/bin/activate

python3 --version

# First argument is the UDP monitoring port
UDP_PORT=$1
shift  # Remove first argument, leaving remaining args as HTTP ports
EMBEDDINGS_PORTS=("$@")

for PORT in "${EMBEDDINGS_PORTS[@]}"; do
    echo "Launching Chromaprint server on port ${PORT} with UDP monitoring on port ${UDP_PORT}"
    python3 -c "import Chromaprint_embeddings_server;
Chromaprint_embeddings_server.run_server(${PORT}, ${UDP_PORT})" &
done
